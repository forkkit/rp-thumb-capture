/*!
 * MIT License
 *
 * Copyright (c) Yuri Sulyma
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("ractive-player")):"function"==typeof define&&define.amd?define(["react","ractive-player"],t):"object"==typeof exports?exports.RPThumbCapture=t(require("react"),require("ractive-player")):e.RPThumbCapture=t(e.React,e.RactivePlayer)}("undefined"!=typeof self?self:this,(function(e,t){return(()=>{"use strict";var n={524:(e,t,n)=>{n.d(t,{default:()=>p});var o=n(888);const r=e=>e,a=(["fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled"].map((e=>document[e])).concat(!1).find((e=>void 0!==e)),["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"].map((e=>document.body[e])).concat((()=>{})).find(r).bind(document.body)),s=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"].map((e=>document[e])).concat((async()=>{})).find(r).bind(document),c=()=>["fullscreen","webkitIsFullScreen","mozFullScreen"].map((e=>document[e])).find((e=>void 0!==e));var l=n(576);const{waitFor:i}=l.Utils.misc,u=l.Utils.misc.wait,d={cols:5,rows:5,height:100,width:160,frequency:4};function p(){const e=(0,l.usePlayer)(),[t,n]=(0,o.useState)(!1),[r,p]=(0,o.useState)([]),m=(0,o.useRef)();(0,o.useEffect)((()=>{const e=document.createElement("style");return e.setAttribute("type","text/css"),e.textContent='#rp-thumb-capture {\n  position: relative;\n}\n\n#rp-thumbs-dialog {\n  background-color: #2A2A2A;\n  border-radius: 2px 2px 0 0;\n  box-shadow: 2px -2px 2px 2px rgba(0, 0, 0, 0.3);\n  box-sizing: border-box;\n  color: #FFF !important;\n  font-family: "Roboto Slab", sans-serif;\n  line-height: 1.5;\n  \n  position: absolute;\n  bottom: 42px;\n  right: 0;\n  \n  padding: .5em;\n}\n\n#rp-thumbs-dialog > label {\n  display: block;\n}\n\n#rp-thumbs-dialog > input {\n  font-family: monospace;\n}\n\n#rp-thumbs-dialog > button {\n    background-color: #A52117;\n    border: 0 none transparent;\n    box-sizing: border-box;\n    color: #FFF;\n    display: block;\n    font-family: "Roboto Slab", sans-serif;\n    font-size: 1em;\n    margin-top: .5em;\n    padding: .25em;\n}\n\n#rp-thumb-sheets > a {\n  display: block;\n}',document.head.appendChild(e),()=>{document.head.removeChild(e)}}),[]);const b=(0,o.useCallback)((async()=>{const t=c(),n=await function(e){let t=0;const n={};return new Promise((o=>{e.onMessage.addListener((r=>{switch(r.type){case"apiDefinition":const a={};r.methodNames.forEach((o=>{a[o]=(...r)=>{const a=t++;return e.postMessage({type:"apiCall",callId:a,methodName:o,arguments:r}),new Promise((e=>{n[a]=e}))}})),Object.freeze(a),o(a);break;case"apiReturn":const{callId:s}=r;n[s](r.value),delete n[s]}})),e.postMessage({type:"establish"})}))}(chrome.runtime.connect(m.current)),{frequency:o}=d,r=[];a(),await i((()=>c()));const l=function(){const e=[[document.querySelector(".rp-controls"),"display","none"],[document.querySelector(".rp-canvas"),"cursor","none"],[document.body,"cursor","none"]];for(let t=0;t<e.length;++t){const[n,o,r]=e[t];e[t][2]=n.style[o],n.style[o]=r}return e}();await u(6e3);const{playback:b}=e;for(let e=0;e<=b.duration;e+=1e3*o)b.seek(e),await u(100),r.push(await n.captureTab());t||s(),function(e){for(const[t,n,o]of e)t.style[n]=o}(l);const f=await async function(e){const{rows:t,cols:n,height:o,width:r}=d,a=t*n,s=document.createElement("canvas");s.setAttribute("width",(r*n).toString()),s.setAttribute("height",(o*t).toString());const c=s.getContext("2d"),l=[];for(let i=0,u=Math.ceil(e.length/a);i<u;++i){c.clearRect(0,0,r*n,o*t);const u=await Promise.all(e.slice(i*a,(i+1)*a).map((e=>new Promise((t=>{const n=document.createElement("img");n.onload=()=>t(n),n.src=e})))));for(let e=0;e<t;++e)for(let t=0;t<n;++t){const a=e*n+t;if(a>=u.length)break;c.drawImage(u[a],t*r,e*o,r,o)}l.push(s.toDataURL("image/png"))}return l}(r);p(f)}),[]),f=(0,o.useCallback)((()=>{n((e=>!e))}),[]),h={display:t?"block":"none"};return o.createElement("div",{id:"rp-thumb-capture"},o.createElement("div",{id:"rp-thumbs-dialog",style:h},o.createElement("label",null,"Extension ID"),o.createElement("input",{id:"rp-thumbs-ext-id",type:"text",onBlur:e.resumeKeyCapture,onFocus:e.suspendKeyCapture,onChange:e=>m.current=e.currentTarget.value}),o.createElement("button",{onClick:b},"Record"),o.createElement("div",{id:"rp-thumb-sheets"},r.map(((e,t)=>o.createElement("a",{key:t,href:e,download:`${t}.png`},"Sheet ",t))))),o.createElement("svg",{onClick:f,height:"36",width:"36",viewBox:"0 0 100 100"},o.createElement("path",{d:"M 10 70 a 1,1 0 0,1 80,0 z",fill:"#FFC0CB",stroke:"#FFF",strokeWidth:"7"}),o.createElement("path",{d:"M 35 66.5 a 1,1 0 0,1 30,0 z",fill:"#FFE0EB",stroke:"none"})))}},576:e=>{e.exports=t},888:t=>{t.exports=e}},o={};function r(e){if(o[e])return o[e].exports;var t=o[e]={exports:{}};return n[e](t,t.exports,r),t.exports}return r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(524)})().default}));